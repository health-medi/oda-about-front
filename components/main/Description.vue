<template>
  <div>
    <section>
      <div
        class="absolute left-4 md:left-44 xl:left-[360px] top-24 md:top-48 z-10"
      >
        <h2 class="md:text-2xl mb-5 md:tracking-widest">
          매년 <span class="font-semibold">반복되는 다이어트..실패..</span
          ><br />이제 진짜 다이어트 하세요!
        </h2>
        <h1
          class="text-3xl md:text-7xl font-bold mb-5 md:mb-10 md:leading-[1.2] md:tracking-tight"
        >
          시작부터 다른<br />오늘의 다이어트
        </h1>
        <img
          class="w-[74px] md:w-auto"
          src="@/assets/images/main/box101.png"
          alt="오다"
        />
      </div>
      <!-- FIXME 임시 -->
      <img
        class="relative max-w-[200%] right-1/2 md:right-auto md:max-w-[1920px] md:left-1/2 md:translate-x-[-50%]"
        src="@/assets/images/main/box1bg.png"
        alt="배경"
      />
    </section>
    <!-- FIXME 임시 -->
    <section class="text-center text-zinc-900 py-[100px] md:py-[200px]">
      <div>
        <h1>
          <span
            class="text-6xl md:text-9xl font-extrabold tracking-tighter counter"
            data-start="0"
            data-end="23357"
            >0</span
          >
          <span class="text-4xl md:text-8xl font-extrabold">명</span
          ><span class="text-3xl md:text-6xl font-bold">이</span>
        </h1>
        <h2 class="text-2xl md:text-5xl font-semibold mt-2 md:mt-5">
          이미 경험했습니다.
        </h2>
        <h3 class="text-xs text-gray-400 mt-3">
          ※ 2021-2024.07 다이어트환 처방 인원 수
        </h3>
      </div>
      <div class="mt-12 md:mt-24">
        <h2 class="text-xl md:text-2xl font-semibold md:tracking-[0.2rem]">
          검증된 처방과 데이터를 기반으로 완성한
        </h2>
        <h1 class="text-3xl md:text-7xl font-extrabold mt-2 md:mt-3">
          오늘의 다이어트
        </h1>
      </div>
    </section>
    <section class="md:relative md:flex md:justify-center">
      <img
        class="absolute z-10 w-[300px] md:w-auto md:bottom-56 mt-64"
        src="@/assets/images/main/box201.png"
        alt="날씬함이 아름다움이 오다"
        data-aos="zoom-in"
        data-aos-duration="1000"
      />

      <img
        class="relative max-w-[200%] md:max-w-[1920px] left-1/2 translate-x-[-50%]"
        src="@/assets/images/main/box2bg.png"
        alt="배경"
      />
    </section>
    <section class="bg-zinc-800 py-16 md:py-44">
      <div
        class="md:flex justify-between text-center *:flex-1 w-full md:w-[1040px] mx-auto gap-4"
      >
        <ul>
          <h1 class="text-[#FF8695] md:text-lg font-bold mb-2 md:mb-4">
            다이어트 환약 처방
          </h1>
          <h2 class="text-white text-2xl md:text-3xl mb-2 md:mb-4">
            <span
              class="counter font-extrabold text-6xl"
              data-start="0"
              data-end="278"
              >0</span
            >만
          </h2>
          <p class="text-zinc-400/75 text-xs">
            2021 - 2024.07<br />다이어트환 처방
          </p>
        </ul>
        <ul class="my-16 md:my-0">
          <h1 class="text-[#FF8695] md:text-lg font-bold mb-2 md:mb-4">
            평균 감량 수치
          </h1>
          <h2 class="text-white text-2xl md:text-3xl mb-2 md:mb-4">
            <span
              class="counter font-extrabold text-6xl"
              data-start="0"
              data-end="-13"
              >0</span
            ><span class="font-extrabold text-6xl">.</span
            ><span
              class="counter font-extrabold text-6xl"
              data-start="0"
              data-end="2"
              >0</span
            >kg
          </h2>
          <p class="text-zinc-400/75 text-xs">
            다이어트 환자 740명 대상<br />3개월 총 감량 수치
          </p>
        </ul>
        <ul>
          <h1 class="text-[#FF8695] md:text-lg font-bold mb-2 md:mb-4">
            3개월 평균 감량률
          </h1>
          <h2 class="text-white text-2xl md:text-3xl mb-2 md:mb-4">
            <span
              class="counter font-extrabold text-6xl"
              data-start="0"
              data-end="16"
              >0</span
            ><span class="font-extrabold text-6xl">.</span
            ><span
              class="counter font-extrabold text-6xl"
              data-start="0"
              data-end="1"
              >0</span
            >%
          </h2>
          <p class="text-zinc-400/75 text-xs">
            3개월간 다이어트 프로그램<br />진행한 분들의 평균 감량률
          </p>
        </ul>
      </div>
    </section>
    <section class="text-center py-20 md:py-40">
      <h1
        class="text-zinc-900 font-bold text-3xl md:text-6xl mb-16 md:mb-32 md:leading-tight"
      >
        나의 다이어트 성공 비법<br />오늘의 다이어트
      </h1>
      <div
        class="flex banner_wraper relative h-[270px] md:h-[480px] w-full overflow-hidden"
      >
        <img
          class="banner top-12 w-[120px] md:w-[241px] mt-8 md:mt-12"
          src="@/assets/images/main/box302.png"
        />
        <video
          class="banner w-[120px] md:w-[241px] rounded-full object-cover mb-8 md:mb-12"
          src="@/assets/images/main/box301.mp4"
          type="video/mp4"
          autoplay
          muted
          loop
        ></video>
        <img
          class="banner w-[120px] md:w-[241px] mt-8 md:mt-12"
          src="@/assets/images/main/box303.png"
        />
        <video
          class="banner w-[120px] md:w-[241px] rounded-full object-cover mb-8 md:mb-12"
          src="@/assets/images/main/box302.mp4"
          type="video/mp4"
          autoplay
          muted
          loop
        ></video>
        <img
          class="banner w-[120px] md:w-[241px] rounded-full object-cover mt-8 md:mt-12"
          src="@/assets/images/main/box304.png"
        />
        <video
          class="banner w-[120px] md:w-[241px] rounded-full object-cover mb-8 md:mb-12"
          src="@/assets/images/main/box303.mp4"
          type="video/mp4"
          autoplay
          muted
          loop
        ></video>
        <img
          class="banner w-[120px] md:w-[241px] mt-8 md:mt-12"
          src="@/assets/images/main/box305.png"
        />
        <video
          class="banner w-[120px] md:w-[241px] rounded-full object-cover mb-8 md:mb-12"
          src="@/assets/images/main/box304.mp4"
          type="video/mp4"
          autoplay
          muted
          loop
        ></video>
        <img
          class="banner w-[120px] md:w-[241px] mt-8 md:mt-12"
          src="@/assets/images/main/box306.png"
        />
        <img
          class="banner w-[120px] md:w-[241px] mb-8 md:mb-12"
          src="@/assets/images/main/box307.png"
        />
        <img
          class="banner w-[120px] md:w-[241px] mt-8 md:mt-12"
          src="@/assets/images/main/box308.png"
        />
      </div>
    </section>

    <section>
      <img
        class="absolute z-10 transform translate-x-[-50%] translate-y-[-30%] w-[200px] md:w-auto md:mt-80 md:pl-80 mt-24 ml-5"
        src="@/assets/images/main/box401.png"
        data-aos="fade-right"
        data-aos-duration="1000"
        alt="오래가는 날씬함"
      />
      <img
        class="relative max-w-[150%] md:max-w-[1920px] left-1/2 translate-x-[-50%]"
        src="@/assets/images/main/box4bg.png"
        alt="배경"
      />
    </section>
    <section class="relative">
      <div class="absolute text-center top-14 md:top-52 z-10 w-full">
        <h2 class="font-semibold text-2xl md:text-5xl">오늘의 다이어트는</h2>
        <h1
          ref="headingElement"
          class="font-bold text-4xl md:text-8xl mt-[80px] md:mt-[280px]"
          data-aos="fade-up"
          data-aos-duration="1000"
        >
          다.릅.니.다.
        </h1>
        <ul
          ref="scrollElement"
          class="absolute w-px md:w-0.5 md:top-24 top-12 h-12 md:h-36 left-1/2 bg-stone-700 md:mt-2"
          data-aos="fade-down"
          data-aos-duration="1000"
        ></ul>
      </div>
      <img
        class="relative max-w-[150%] md:max-w-[1920px] left-1/2 translate-x-[-50%]"
        src="@/assets/images/main/box5bg.png"
        alt="배경"
      />
    </section>
    <section
      class="bg-[url('@/assets/images/main/box6bg.png')] text-center md:text-left py-16"
    >
      <article
        class="md:flex items-center justify-between w-full md:w-[1150px] md:my-22 mx-auto p-6 md:p-0"
      >
        <div class="md:w-[455px]" data-aos="fade-up" data-aos-duration="1000">
          <span
            class="rounded-full bg-white text-[#FF6079] font-bold text-base md:text-lg py-3 px-6"
            >Point 1</span
          >
          <h1
            class="text-zinc-900 font-bold tracking-tighter text-3xl md:text-5xl mt-10 md:w-[260px] md:leading-tight"
          >
            시작부터 다른 스마트 진단
          </h1>
          <h2 class="text-[#777777] md:text-xl font-medium mt-6 break-keep">
            비만은 선천적인 체질만큼 후천적인 생활습관의 영향을 많이 받습니다.
            오다의 스마트 진단 시스템은 개인의 선천적 체질 뿐만 아니라
            생활습관까지
            <span class="text-[#333333] font-semibold"
              >비만의 정확한 원인을 세밀하게 분석</span
            >합니다.
          </h2>
        </div>
        <img
          class="w-[253px] md:w-auto inline mt-12 md:mt-0"
          src="@/assets/images/main/box601.png"
          alt="스마트 진단"
        />
      </article>
    </section>
    <section class="bg-white text-center md:text-left md:py-28">
      <article
        class="md:flex flex-row-reverse items-center justify-between w-full md:w-[1150px] my-16 md:my-16 mx-auto p-6 md:p-0"
      >
        <!-- data-scroll="toggle(.anidep1, .aniout)" -->
        <div class="md:w-[480px]" data-aos="fade-up" data-aos-duration="1000">
          <span
            class="rounded-full bg-[#FEF2F2] text-[#FF6079] font-bold text-base md:text-lg py-3 px-6"
            >Point 2</span
          >
          <h1
            class="text-zinc-900 font-bold tracking-tighter text-3xl md:text-5xl mt-10 md:leading-tight"
          >
            퍼스널 다이어트 솔루션
          </h1>
          <h2 class="text-[#777777] md:text-xl font-medium mt-6 break-keep">
            오다는 21년 다이어트 진료 노하우로
            <span class="text-[#333333] font-semibold"
              >개인 체질, 생활습관, 건강 상태, 다이어 트 경험, 목표 체중</span
            >
            등에 따라 퍼스널 다이어트 솔루션을 제공합니다.
          </h2>
          <h2 class="text-[#777777] md:text-xl font-medium mt-6 break-keep">
            <span class="text-[#333333] font-semibold"
              >전담 한의사가 체질분석 및 진단을 통해 5단계 맞춤한약을 처방</span
            >하며 체중감량 상태에 따른 처방의 변화로 다이어트 효과를 극대화
            합니다.
          </h2>
        </div>
        <img
          class="w-[255px] md:w-auto inline mt-12 md:mt-0"
          src="@/assets/images/main/box602.png"
          alt="다이어트 경험, 생활습관, 건강상태, 목표체중, 체질"
        />
      </article>
    </section>
    <section
      class="bg-[#e7f4ff] md:bg-[url('@/assets/images/main/box7bg.png')] bg-center text-center md:text-left md:h-[840px] py-16"
    >
      <article
        class="md:flex items-center justify-between w-full md:w-[1150px] md:mt-44 md:mb-60 mx-auto p-6 md:p-0"
      >
        <div class="md:w-[440px]" data-aos="fade-up" data-aos-duration="1000">
          <span
            class="rounded-full bg-white text-[#FF6079] font-bold text-base md:text-lg py-3 px-6"
            >Point 3</span
          >
          <h1
            class="text-zinc-900 font-bold tracking-tighter text-3xl md:text-5xl mt-10 md:leading-tight"
          >
            하루 2번 간편한 복용
          </h1>
          <h2 class="text-[#777777] md:text-xl font-medium mt-6 break-keep">
            오다는 하루 2번이면 충분합니다.<br />오다는 부형제 없는 100% 천연
            한약재 성분의 업그레이드 된 처방조성과 약재 수치를 통한 추출률
            향상으로 약효의 지속성을 높였습니다.
          </h2>
          <h2 class="text-[#777777] md:text-xl font-medium mt-6 break-keep">
            <span class="text-[#333333] font-semibold"
              >하루 2번 복용 만으로도 3번 복용의 효과</span
            >를 얻을 수 있습니다.
          </h2>
        </div>
        <img
          class="w-[313px] inline md:hidden"
          src="@/assets/images/main/box701.png"
          alt="오다 패키지"
        />
      </article>
    </section>
    <section class="bg-white text-center md:text-left">
      <article
        class="md:flex flex-row-reverse items-center justify-between w-full md:w-[1150px] my-16 md:my-32 mx-auto p-6 md:p-0"
      >
        <div class="md:w-[420px]" data-aos="fade-up" data-aos-duration="1000">
          <span
            class="rounded-full bg-[#FEF2F2] text-[#FF6079] font-bold text-base md:text-lg py-3 px-6"
            >Point 4
          </span>
          <h1
            class="text-zinc-900 font-bold tracking-tighter text-3xl md:text-5xl mt-10 md:w-[260px] md:leading-tight"
          >
            전담 한의사의 1:1 맞춤 코칭
          </h1>
          <h2 class="text-[#777777] md:text-xl font-medium mt-6 break-keep">
            오다는 꼼꼼합니다. 단순히 한약 처방으로 끝나는 것이 아닙니다. 오다
            앱에 목표 체중을 설정하고 다이어트 중에 식단, 운동, 생활습관을
            남겨주세요.
          </h2>
          <h2 class="text-[#777777] md:text-xl font-medium mt-6 break-keep">
            <span class="text-[#333333] font-semibold"
              >전담 한의사가 작은 체중 변화까지 꼼꼼하게 체크하여 철저하게
              관리</span
            >해 드립니다.
          </h2>
        </div>
        <img
          class="w-[255px] md:w-auto inline mt-12 md:mt-0"
          src="@/assets/images/main/box702.png"
          alt="오다 어플"
        />
      </article>
    </section>
    <section class="relative text-white text-center">
      <!-- 이미지 -->
      <img
        class="relative max-w-[150%] md:max-w-[1920px] left-1/2 translate-x-[-50%]"
        src="@/assets/images/main/box8bg.png"
      />

      <!-- 텍스트 및 버튼 -->
      <div
        class="absolute z-10 w-full bottom-12 md:bottom-48 left-1/2 transform translate-x-[-50%]"
      >
        <h1 class="text-2xl md:text-5xl font-bold md:leading-tight">
          늦기 전에<br />오<span class="font-light">늘의</span> 다<span
            class="font-light"
            >이어트를</span
          >
          시작하세요.
        </h1>
        <a
          class="inline-block rounded-full bg-[#FF6079] py-2 md:py-4 px-10 md:px-20 mt-5 md:mt-10 text-base md:text-2xl font-bold hover:bg-[#ff3e5c] transition-all"
          href="#"
        >
          <NuxtLink to="/map">상담 신청 하기</NuxtLink>
        </a>
      </div>
    </section>
  </div>
</template>
<script setup>
import { gsap } from "gsap";
import ScrollTrigger from "gsap/ScrollTrigger";
gsap.registerPlugin(ScrollTrigger);

// 숫자 애니메이션에 사용될 counter 데이터
const counters = ref([
  { start: 0, end: 23357 },
  { start: 0, end: 278 },
  { start: 0, end: -13 },
  { start: 0, end: 2 },
  { start: 0, end: 16 },
  { start: 0, end: 1 },
  // 추가적인 counter 데이터를 여기에 추가
]);

// 배너 애니메이션에 사용될 banner 데이터
const banners = ref([
  { id: 1, width: 300 }, // 예시 데이터, 실제로는 배너 콘텐츠로 대체
  { id: 2, width: 300 },
  { id: 3, width: 300 },
  { id: 4, width: 300 },
]);

const bannerLeft = ref(0);
const scrollPosition = ref(0);

const first = ref(1);
let last;
let imgCnt = banners.value.length;

// Counter 업데이트 함수
const updateCounter = (el, start, end, duration, addCommas) => {
  let startTime;
  const animateCounter = (timestamp) => {
    if (!startTime) startTime = timestamp;
    const progress = (timestamp - startTime) / duration;
    const current = Math.round(start + progress * (end - start));
    const formattedNumber = addCommas ? current.toLocaleString() : current;
    el.textContent = formattedNumber;

    if (progress < 1) {
      requestAnimationFrame(animateCounter);
    } else {
      el.textContent = addCommas ? end.toLocaleString() : end;
    }
  };
  requestAnimationFrame(animateCounter);
};

// Scroll 이벤트 핸들러
const handleScroll = () => {
  scrollPosition.value = window.scrollY;
};

// 배너 애니메이션 초기화
const initBannerAnimation = () => {
  const $banners = document.querySelectorAll(".banner_wraper .banner");
  let bannerWidth = $banners[0].offsetWidth; // 배너 너비
  let totalWidth = bannerWidth * $banners.length;

  // 배너 초기 위치 설정
  gsap.set($banners, { x: (index) => index * bannerWidth });

  // 애니메이션 설정
  gsap.to($banners, {
    x: `-=${totalWidth}`,
    duration: 20, // 애니메이션 지속 시간
    repeat: -1, // 무한 반복
    ease: "linear",
  });
};

// GSAP을 이용한 애니메이션 설정
const initGsapAnimations = () => {
  // fade-up 애니메이션
  gsap.from(".fade-up", {
    opacity: 0,
    y: 50,
    duration: 1,
    scrollTrigger: {
      trigger: ".fade-up",
      start: "top 80%",
      end: "bottom top",
      scrub: true,
    },
  });

  // zoom-in 애니메이션
  gsap.from(".zoom-in", {
    scale: 0.5,
    opacity: 0,
    duration: 1,
    scrollTrigger: {
      trigger: ".zoom-in",
      start: "top 80%",
      end: "bottom top",
      scrub: true,
    },
  });
};

// Watch 함수
watch(scrollPosition, (newValue) => {
  const winHeight = window.innerHeight;

  counters.value.forEach((counter, index) => {
    const $el = document.querySelectorAll(".counter")[index];
    const rect = $el.getBoundingClientRect();
    const contentHeight = rect.bottom - rect.top;
    const exposurePercentage = 100;

    if (
      rect.top <= winHeight - (contentHeight * exposurePercentage) / 100 &&
      rect.bottom >= (contentHeight * exposurePercentage) / 100 &&
      !$el.dataset.scrolled
    ) {
      const start = parseInt(counter.start);
      const end = parseInt(counter.end);
      updateCounter($el, start, end, 1100, true);
      $el.dataset.scrolled = true;
    }
  });
});
// Vue에서 onMounted() 또는 다른 라이프사이클 훅에서 이 함수를 호출하여 초기화합니다.
// 컴포넌트가 마운트된 후 초기화
onMounted(() => {
  window.addEventListener("scroll", handleScroll);
  initBannerAnimation();
  // initGsapAnimations();
  handleScroll(); // 초기 스크롤 상태 확인
});
</script>
